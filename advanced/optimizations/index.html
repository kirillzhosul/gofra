<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Optimizer and optimizations - Gofra</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Gofra</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">About</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../installation/" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../tutorial/" class="nav-link">Tutorial</a>
                            </li>
                            <li class="nav-item">
                                <a href="../" class="nav-link">Advanced</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/kirillzhosul/gofra/edit/main/docs/advanced/optimizations.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#optimizer-and-optimizations" class="nav-link">Optimizer and optimizations</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#optimizer-level-features" class="nav-link">Optimizer level features</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#optimization-features-passes" class="nav-link">Optimization features (passes)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#dce-dead-code-elimination" class="nav-link">DCE (Dead-Code-Elimination)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#function-inlining" class="nav-link">Function inlining</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="optimizer-and-optimizations">Optimizer and optimizations</h1>
<p>Gofra has builtin optimizer that helps optimize your code 
(from top-level HIR optimizations to low-level LIR ones according to selected target)</p>
<p>By default optimizer and all optimizations is disabled for development assistance and decreased build time, 
optimizations may be enabled via CLI using <code>-O{N}</code> flag with desired level of optimizations (<code>-01</code>, <code>-02</code> is supported for now)</p>
<h2 id="optimizer-level-features">Optimizer level features</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Optimization</th>
<th style="text-align: left;">Minimum level</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">DCE</td>
<td style="text-align: left;">1</td>
</tr>
<tr>
<td style="text-align: left;">Function inlining</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
<h1 id="optimization-features-passes">Optimization features (passes)</h1>
<p>Here is an list of all possible optimizations that optimizer may apply</p>
<h2 id="dce-dead-code-elimination">DCE (Dead-Code-Elimination)</h2>
<hr />
<p>Minimum optimization level: <strong>1</strong> (<code>-O1</code>) <br/>
Impact: <strong>Reduced binary size</strong>
Flag: <code>-fdce</code>, <code>fno-dce</code></p>
<p>DCE searchs for functions that is not being called atleast once and removes them from final IR so them does not appear in final binary as being unused.
Does not removes <code>global</code> functions as their usage is outside of an Gofra program.</p>
<p>For example this function may be removed by DCE</p>
<pre><code class="language-gofra">// [Additionally, most of binary size comes for example from libraries which gives you a lot of functions]
include &quot;std.gof&quot;

func void test_function[]
    // This function is unused so it will be safely remove
    ...
end

func void main[]
    &quot;Hello, World!\n&quot; print
end
</code></pre>
<p><code>--dce-max-iterations</code> affects max iterations that DCE may perform, by default it is around <strong>128</strong> which is mostly fine, for example if function is removed, optimizer must review program code again as that function may reference other functions which is became unused due to removed that initial function.</p>
<h2 id="function-inlining">Function inlining</h2>
<hr />
<p>Minimum optimization level: <strong>1</strong> (<code>-O1</code>) <br/>
Impact: <strong>Increased binary size</strong>, <strong>Increased performance</strong>
Flag: <code>-finline-functions</code>, <code>fno-inline-functions</code></p>
<p>Function inlining automatically marks simple / small functions as inlineable and resolves their usages after that marking.
Inlining is not performed for recusrive functions, as it will break not only the code but also optimizer itself (while resolving inline function reference infinite amount of iterations until threshold)
For example:</p>
<pre><code class="language-gofra">func int reduce_pairs[int,int,int,int]
    + + +
end

func void main[]
    1 2 3 4 reduce_pairs // yields 10
end

// After inlining this is becomes:
inline func int reduce_pairs[int,int,int,int]
    + + +
end


// And main is reduced to:
func void main[]
    1 2 3 4 + + + // yields 10
end
// [which is also may be optimized using CF (constant-folding)]

</code></pre>
<p><code>--inline-functions-max-iterations</code> affects max iterations for function inlining to search for new inlined function usage in other functions. 
Low limit will result into unknown function call at assembler stage. This may slightly increase finaly binary size</p>
<p><code>--inline-functions-max-operators</code> affects max amount of operators to treat function as inlineable. 
Setting big number will lead to almost all function will be treated as inline ones.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
