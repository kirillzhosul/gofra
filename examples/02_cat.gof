
// ==============================================
// `cat` analogue
// Opens an text file from PATH macro and emits it content into standard
// ==============================================

#include "std"

// TODO(@kirillzhosul): Research why non-existent file returns STDERR FD
// TODO: add argc argv
// TODO: Windows support
const PATH = "test.txt"

// Some segment in memory so we can store content of the file
// Global one as capacity is too big for stack (heap)
var buf char[1024]


func void main[]
    var sv string;
    var fd int;

    &sv.data &buf !<
    &sv.len sizeof buf !<
    
    &fd PATH call open_file_fd_ro !<
    fd 0 < if 
        "Unable to open given file\n" eprint_fatal 
    end

    // Read file

    fd &sv call read_file_sv false == if 
        "Unable to read given file\n" eprint_fatal 
    end

    // Print whole buffer
    &sv call print
end